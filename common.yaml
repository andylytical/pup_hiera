---
###
# Keep lookup_options at TOP
###

lookup_options:
    sudo::configs:
        merge:
            strategy: deep
            merge_hash_arrays: true

###
# Everything else should be sorted alphabetically
###

baseline_cfg::networkmanager::enable: true
baseline_cfg::networkmanager::ensure: running

chronyd::servers: [ 'pool.ntp.org' ]

firewalld::default_zone: public
firewalld::zones:
    public:
        target: DROP
        #purge_rich_rules: true
        #purge_services: true
        #purge_ports: true

lsst_system_authnz::access::access_allow:
    'Allow group lsst_sysadm from ALL':
        group: lsst_sysadm
        origin: ALL
lsst_system_authnz::access::access_deny_before:
    'Deny group lsst_disabled from ALL':
        group: lsst_disabled
        origin: ALL
    'Deny group all_disabled_usr from ALL':
        group: all_disabled_usr
        origin: ALL

lsst_system_authnz::kerberos::cfg_file_settings:
    /etc/krb5.conf.d/domain_realm.conf: |
        # This file is managed by Puppet.
        [domain_realm]
        .ncsa.illinois.edu = NCSA.EDU
        .ncsa.uiuc.edu = NCSA.EDU
        .ncsa.edu = NCSA.EDU
        .cosmology.illinois.edu = NCSA.EDU
    /etc/krb5.conf.d/kdc.conf: |
        # This file is managed by Puppet.
        [kdc]
        profile = /etc/kdc.conf
        afs_salt = NCSA.UIUC.EDU
    /etc/krb5.conf.d/libdefaults.conf: |
        # This file is managed by Puppet.
        [libdefaults]
        default_ccache_name = KEYRING:persistent:%{literal('%')}{uid}
        default_realm = NCSA.EDU
        forwardable = true
        noaddresses = false
    /etc/krb5.conf.d/realms.conf: |
        # This file is managed by Puppet.
        [realms]
        NCSA.EDU = {
        kdc = krb-lsst-ncsa1.ncsa.illinois.edu:88
        kdc = krb-lsst-ncsa2.ncsa.illinois.edu:88
        kdc = straw.ncsa.illinois.edu:88
        kdc = wood.ncsa.illinois.edu:88
        kdc = kerberos.ncsa.illinois.edu:88
        admin_server = kadmin.ncsa.illinois.edu:749
        default_domain = ncsa.illinois.edu
        }
lsst_system_authnz::kerberos::createhostuser: lsst
lsst_system_authnz::kerberos::krb5_domain: NCSA.EDU


lsst_system_authnz::sssd::filter_users:
#NCSA users UID<1000
    - acraig
    - bw
    - cbushell
    - ceperley
    - cox
    - ferguson
    - johns
    - lex
    - norman
    - proth
    - radha
    - redman
    - rkufrin
    - scott
    - scoyle
    - straka
    - svinson
    - u10956
    - welge
    - wicker
lsst_system_authnz::sssd::krb5_realm: NCSA.EDU
lsst_system_authnz::sssd::ldap_backup_uri:
    - ldaps://ldap1.ncsa.illinois.edu
    - ldaps://ldap2.ncsa.illinois.edu
    - ldaps://ldap.ncsa.illinois.edu
lsst_system_authnz::sssd::ldap_domain: ncsa.illinois.edu
lsst_system_authnz::sssd::ldap_group_search_base: dc=ncsa,dc=illinois,dc=edu?sub?(&(objectclass=groupOfUniqueNames)(|(cn=lsst_*)(cn=all_lsst)(cn=all_disabled_usr)(cn=grp_202)))
lsst_system_authnz::sssd::ldap_search_base: dc=ncsa,dc=illinois,dc=edu
lsst_system_authnz::sssd::ldap_uri:
    - ldaps://ldap-lsst-ncsa1.ncsa.illinois.edu
    - ldaps://ldap-lsst-ncsa2.ncsa.illinois.edu
lsst_system_authnz::sssd::ldap_user_search_base: dc=ncsa,dc=illinois,dc=edu?sub?(&(objectclass=inetOrgPerson)(memberOf=cn=all_lsst,ou=groups,dc=ncsa,dc=illinois,dc=edu))
lsst_system_authnz::sssd::simple_allow_groups:
    - lsst_admin_ncsa
lsst_system_authnz::sssd::override_homedir: /home/%u
lsst_system_authnz::sssd::simple_deny_groups:
    - all_disabled_usr
    - lsst_disabled

ntp::package_ensure: absent
ntp::service_manage: false
ntp::step_tickers_file: ~

rsyslog::client::log_local: true
rsyslog::client::remote_servers: false
rsyslog::client::remote_type: 'tcp'
rsyslog::client::preserve_fqdn: true

sudo::configs:
    defaults:
        priority: 0
        content:
            - 'Defaults   !visiblepw'
            - 'Defaults    always_set_home'
            - 'Defaults    env_reset'
            - 'Defaults    env_keep =  "COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS"'
            - 'Defaults    env_keep += "MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE"'
            - 'Defaults    env_keep += "LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES"'
            - 'Defaults    env_keep += "LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE"'
            - 'Defaults    env_keep += "LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY"'
            - 'Defaults    match_group_by_gid'
            - 'Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin'
            - 'root ALL=(ALL)   ALL'
            - '%wheel   ALL=(ALL)   ALL'
    common_disabled_users:
        priority: 1
        content:
            - '#deny former NCSA users'
            - '%all_disabled_usr ALL=(ALL) !ALL'
            - '#deny users in lsst_disabled LDAP group'
            - '%lsst_disabled ALL=(ALL) !ALL'
    common_lsst_admins:
        priority: 10
        content:
            - '%lsst_sysadm ALL=(ALL) NOPASSWD: ALL'
